<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="character-sarah">
    <template>

        <style>
            /* local styles go here */
            
            :host {
                display: block;
                height: 64px;
                width: 64px;
                background-image: url(../src/img/sarah_bow.png);
            }
            
            :host([direction=up]) {
                background-position-y: -512px;
            }
            
            :host([direction=left]) {
                background-position-y: -576px;
            }
            
            :host([direction=down]) {
                background-position-y: -640px;
            }
            
            :host([direction=right]) {
                background-position-y: -704px;
            }
            
            :host([move]) {
                /* Animation name */
                animation-name: move;
                /* Animation time */
                animation-duration: 0.8s;
                /* Animation execution times */
                animation-iteration-count: infinite;
                /* Step number to run the animation */
                animation-timing-function: steps(9);
            }
            
            input {
                margin: 0;
                padding: 0;
                height: 0;
                width: 0;
                border: none;
            }
            
            @keyframes move {
                from {
                    background-position-x: 0
                }
                to {
                    background-position-x: -576px
                }
            }
        </style>
        <!-- local DOM goes here -->
        <input id="control" on-keydown="walk" on-keyup="stop" />
    </template>

    <script>
  Polymer({
    /* this is the element's prototype */
    is: 'character-sarah',
    properties: {
      direction : {
          type: String,
          value: "down",
          notify: true,
          reflectToAttribute: true
      },
      move: {
        type: Boolean,
        value: false,
        notify: true,
        reflectToAttribute: true
      },
      target: {
        type: Object,
        value: function() {
        return this.$.control;
        }
    }
    },
    listeners: {
        'tap' : 'characterFocus'
    },
    characterFocus : function () {
        var characterControl = this.$.control;
        characterControl.focus();
    },
    walk: function(event) {
      event.preventDefault();
      /*
      To avoid memory leak, the character move on the first
      keyboard event
      */
      if (!this.move) {
          var keycodes = {37 : "left", 40 : "down", 39 : "right", 38 : "up"};
          var direction = keycodes[event.keyCode];
          if (direction != undefined) {
              this.direction = direction;
              this.move = true;
          }
      }
    },
    stop: function() {
        this.move = false;
    }
  });
  </script>

</dom-module>