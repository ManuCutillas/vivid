<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="./sarah.html">

<dom-module id="vivid-map">
    <template>
        <style>
            :host {
                display: block;
                margin-left: auto;
                margin-right: auto;
                height: 64px;
                width: 640px;
                background-color: blanchedalmond;
                text-align: center;
            }

            :host input {
                margin: 0;
                padding: 0;
                height: 0;
                width: 0;
                border: none;
            }
        </style>
        <input id="character-control" on-keydown="walk" on-keyup="stop" />
        <character-sarah move="[[characterMove]]" direction="[[characterDirection]]"></character-sarah>
    </template>
    <script>
        Polymer({
            is: 'vivid-map',

            properties: {
                characterDirection : {
                    type: String,
                    notify: true,
                    reflectToAttribute: false
                },
                characterMove: {
                    type: Boolean,
                    value: false,
                    notify: true,
                    reflectToAttribute: false
                }
            },

            listeners: {
                'tap' : 'characterFocus'
            },
            characterFocus : function () {
                var characterControl = this.$['character-control'];
                characterControl.focus();
            },

            walk: function(event) {
                event.preventDefault();
                /*
                To avoid memory leak, the character move on the first
                keyboard event
                */
                if (!this.characterMove) {
                    var keycodes = {37 : "left", 40 : "down", 39 : "right", 38 : "up"};
                    var characterDirection = keycodes[event.keyCode];
                    if (characterDirection != undefined) {
                        this.characterDirection = characterDirection;
                        this.characterMove = true;
                    }
                }
            },

            stop: function() {
                this.characterMove = false;
            }
        });
    </script>
</dom-module>